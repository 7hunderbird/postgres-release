groups:
- name: release-upgrade
  jobs:
  - deploy-master-postgres
#  - populate-db
#  - upgrade-postgres
#  - check-db
#  - delete-deployment

resources:
- name: postgres-release-develop
  type: git
  source:
    uri: https://github.com/cloudfoundry/postgres-release.git
    branch: develop

- name: postgres-ci-env
  type: git
  source:
    uri: git@github.com:cloudfoundry/postgres-ci-env
    branch: master
    private_key: {{postgres_ci_env_private_key}}

- name: postgres-release-master
  type: git
  source:
    uri: https://github.com/cloudfoundry/postgres-release.git
    branch: master

jobs:
- name: deploy-master-postgres
  serial_groups: [deploy]
  plan:
  - aggregate:
    - get: postgres-ci-env
    - get: postgres-release
      resource: postgres-release-develop
  - task: deploy-postgres
    file: postgres-release/ci/scripts/deploy-postgres/task.yml
    params:
      BOSH_DIRECTOR: {{postgres_cf_bosh_director}}
      BOSH_USER: {{postgres_cf_bosh_user}}
      BOSH_PASSWORD: {{postgres_cf_bosh_password}}

