#!/bin/bash -ex
pgversion="postgres-9.4.9"

JOB_DIR=/var/vcap/jobs/postgres
PACKAGE_DIR="/var/vcap/packages/${pgversion}"
STORE_DIR=/var/vcap/store
DATA_DIR="${STORE_DIR}/${pgversion}"

DATA_DIR_PREVIOUS="${STORE_DIR}/postgres-previous"
DATA_DIR_OLD="${STORE_DIR}/postgres-unknown"
PACKAGE_DIR_OLD=/var/vcap/packages/postgres-unknown

if [ -d "${STORE_DIR}/postgres-9.4.6" -a -f "${STORE_DIR}/postgres-9.4.6/postgresql.conf" ]; then
  DATA_DIR_OLD="${STORE_DIR}/postgres-9.4.6"
  PACKAGE_DIR_OLD=/var/vcap/packages/postgres-9.4.6
fi

if [ -d "${STORE_DIR}/postgres-9.4.5" -a -f "${STORE_DIR}/postgres-9.4.5/postgresql.conf" ]; then
  DATA_DIR_OLD="${STORE_DIR}/postgres-9.4.5"
  PACKAGE_DIR_OLD=/var/vcap/packages/postgres-9.4.5
fi

RUN_DIR=/var/vcap/sys/run/postgres
LOG_DIR=/var/vcap/sys/log/postgres
# external_pid_file in postgresql.conf takes care of
# overwriting $PIDFILE with actual DB server pid
PIDFILE="${RUN_DIR}/postgres.pid"

HOST="0.0.0.0"
PORT="<%= p("databases.port") %>"

if [[ -n "${LD_LIBRARY_PATH:-}" ]]; then
  LD_LIBRARY_PATH="${PACKAGE_DIR}/lib:${LD_LIBRARY_PATH}"
else
  LD_LIBRARY_PATH="${PACKAGE_DIR}/lib"
fi
